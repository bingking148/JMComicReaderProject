# JMComicReaderProject 部署说明

## 项目概述

JMComicReaderProject 是一个完整的JM漫画查找、展示、下载、阅读和管理系统，基于Python Flask后端和HTML5前端开发。

## 系统要求

- **操作系统**: Windows 10/11 (推荐)
- **Python版本**: Python 3.8+
- **内存要求**: 至少4GB RAM
- **存储空间**: 至少10GB可用空间（用于存储漫画）
- **网络**: 稳定的网络连接

## 项目结构

```
E:\JMComicReaderProject\
├── backend/                  # 后端代码
│   ├── app.py               # Flask主应用
│   ├── services/            # 业务逻辑模块
│   │   ├── jm_crawler.py    # JM漫画爬虫
│   │   ├── download_manager.py # 下载管理
│   │   └── comic_manager.py # 漫画管理
│   ├── models/              # 数据模型
│   │   └── database.py      # 数据库操作
│   └── jm_option.yml        # JM爬虫配置文件
├── frontend/                # 前端代码
│   ├── static/              # 静态资源
│   │   ├── css/            # 样式文件
│   │   │   └── style.css   # 主样式
│   │   └── js/             # JavaScript文件
│   │       └── app.js      # 主脚本
│   └── templates/           # HTML模板
│       ├── index.html      # 首页
│       ├── search.html     # 搜索结果页
│       ├── downloaded.html # 已下载页
│       ├── detail.html     # 漫画详情页
│       └── reader.html     # 阅读页
├── DownloadedComics/        # 已下载漫画存储
├── TempCache/              # 临时缓存
├── requirements.txt        # Python依赖
├── comics.db              # SQLite数据库
├── start.py                # 启动脚本（Linux/Mac）
├── start.bat               # 启动脚本（Windows）
└── README.md              # 项目说明
```

## 安装步骤

### 1. 环境准备

1. **安装Python**

   - 从[Python官网](https://www.python.org/)下载并安装Python 3.8或更高版本
   - 安装时勾选"Add Python to PATH"选项

2. **验证Python安装**

   ```bash
   python --version
   pip --version
   ```

### 2. 项目部署

1. **创建项目目录**

   ```bash
   # 在E盘创建项目目录
   mkdir E:\JMComicReaderProject
   cd E:\JMComicReaderProject
   ```

2. **创建虚拟环境（推荐）**

   ```bash
   python -m venv venv
   venv\Scripts\activate  # Windows
   ```

3. **安装依赖**

   ```bash
   pip install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple
   ```

   **注意**: 如果遇到某些包安装失败，可以单独安装：

   ```bash
   pip install flask flask-cors pillow img2pdf aiohttp aiofiles
   ```

4. **安装JMComic依赖（重要）**

   ```bash
   pip install jmcomic -i https://mirrors.aliyun.com/pypi/simple
   ```

   如果`jmcomic`安装失败，请参考替代方案：
   - 使用`pip install jmcomic -U`更新安装
   - 或者手动下载安装包

### 3. 配置文件

1. **JM爬虫配置**

   项目会自动创建`backend/jm_option.yml`配置文件，包含：
   - 重试次数: 5次
   - 并发下载: 30个线程
   - 缓存启用: 是
   - 自动PDF生成: 启用

2. **数据库初始化**

   首次运行时会自动创建`comics.db`数据库，包含：
   - 已下载漫画表
   - 搜索历史表
   - 下载历史表
   - 阅读历史表
   - 系统配置表

### 4. 启动服务

1. **启动后端服务**

   ```bash
   cd E:\JMComicReaderProject\backend
   python app.py
   ```

2. **验证服务启动**

   看到以下输出表示服务启动成功：

   ```
   * Running on all addresses (0.0.0.0)
   * Running on http://127.0.0.1:5000
   * Running on http://[你的IP]:5000
   ```

3. **访问应用**

   打开浏览器，访问：
   - 本地访问: http://localhost:5000
   - 网络访问: http://[你的IP]:5000

## 使用说明

### 基本功能

1. **搜索漫画**
   - JM号搜索：输入纯数字如"114514"
   - 关键词搜索：输入任意关键词如"萝莉"

2. **下载漫画**
   - 在详情页点击"开始下载"
   - 支持异步下载，可后台进行
   - 实时显示下载进度

3. **阅读漫画**
   - 在"已下载漫画"页面点击"阅读"
   - 支持翻页、缩放、全屏
   - 键盘快捷键操作
   - 多章节漫画可以切换章节

4. **管理漫画**
   - 查看已下载列表
   - 删除不需要的漫画
   - 清理缓存文件

### 高级功能

1. **缓存管理**
   - 自动检测缓存大小
   - 超过100MB时提醒清理
   - 手动清理临时文件

2. **阅读记录**
   - 自动保存阅读进度
   - 记录最后阅读时间
   - 支持继续阅读

3. **多线程下载**
   - 支持30个并发线程
   - 智能重试机制
   - 断点续传功能

## 常见问题

### 1. 依赖安装失败

**问题**: `jmcomic`或其他依赖安装失败

**解决**:
```bash
# 更新pip
python -m pip install --upgrade pip

# 使用国内镜像
pip install jmcomic -i https://pypi.tuna.tsinghua.edu.cn/simple

# 或者手动下载whl文件安装
```

### 2. 服务启动失败

**问题**: 端口被占用或其他错误

**解决**:
```bash
# 检查端口占用
netstat -ano | findstr :5000

# 修改端口（在app.py中修改）
app.run(debug=True, host='0.0.0.0', port=8080)
```

### 3. 漫画下载失败

**问题**: 网络连接或爬虫配置问题

**解决**:
- 检查网络连接
- 更新`jm_option.yml`中的域名配置
- 增加重试次数

### 4. 图片显示异常

**问题**: 图片加载失败或显示不正确

**解决**:
- 检查文件路径权限
- 清理浏览器缓存
- 检查图片文件完整性

## 性能优化

### 1. 缓存优化

- 定期清理`TempCache`目录
- 监控缓存大小，超过100MB及时清理
- 合理设置缓存策略

### 2. 数据库优化

- 定期清理历史记录（30天以上）
- 优化查询语句
- 建立合适的索引

### 3. 网络优化

- 使用CDN加速（如需要）
- 合理设置并发数
- 使用压缩传输

## 安全注意事项

1. **合规使用**
   - 仅供个人学习研究使用
   - 禁止商业用途
   - 遵守相关法律法规

2. **网络安全**
   - 不要在公共网络暴露服务
   - 设置防火墙规则
   - 定期更新依赖包

3. **数据安全**
   - 定期备份重要数据
   - 保护个人隐私
   - 合理设置文件权限

## 更新维护

### 1. 依赖更新

```bash
# 检查更新
pip list --outdated

# 更新依赖
pip install --upgrade package_name
```

### 2. 功能扩展

- 添加新的搜索源
- 优化阅读体验
- 增加用户系统

### 3. 故障排查

- 查看日志文件
- 监控资源使用
- 定期性能测试

## 技术支持

如遇到问题，请检查：
1. 日志输出信息
2. 网络连接状态
3. 文件权限设置
4. 依赖版本兼容性

## 免责声明

本软件仅供学习研究使用，用户应遵守相关法律法规，合理使用各项功能。开发者不对用户的使用行为承担任何法律责任。

---

**版本**: v1.0.0  
**更新日期**: 2024年  
**作者**: JMComicReaderProject Team
