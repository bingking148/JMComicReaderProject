# 修复下载漫画阅读和显示问题的计划

## 问题分析
经过代码分析，发现两个主要问题：
1. **阅读器加载失败**：API请求URL已修复，但可能存在文件路径和数据库同步问题
2. **已下载漫画不显示**：API请求URL已修复，但可能存在下载完成后数据库更新问题

## 修复方案

### 1. 修复下载完成后的数据库同步问题
- 检查 `download_manager.py` 中的下载完成回调
- 确保下载完成后正确调用 `comic_manager.add_downloaded_comic()`
- 修复可能的异步问题，确保数据库更新在文件移动完成后执行

### 2. 修复漫画阅读器页面加载问题
- 检查 `comic_manager.py` 中的 `get_comic_chapters()` 方法
- 确保正确识别下载的漫画目录结构
- 修复章节路径和页面路径的匹配逻辑

### 3. 优化API响应处理
- 检查 `app.py` 中的 `/api/read/<jm_id>` 端点
- 确保返回正确的章节信息和路径
- 添加更详细的错误日志以便调试

### 4. 增强错误处理和调试信息
- 在关键函数中添加更多日志输出
- 改进前端错误提示，提供更具体的错误信息
- 添加文件存在性检查

## 实施步骤
1. 修复下载管理器中的数据库同步逻辑
2. 优化漫画管理器中的章节和页面路径处理
3. 改进API端点的错误处理
4. 增强前端的错误提示和调试信息
5. 测试整个下载和阅读流程